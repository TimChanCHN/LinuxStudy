# 网卡驱动
## 1. 网卡驱动说明
1. 网卡设备是实现硬件和网络层进行信息交互的设备，也是实现网络协议的最底层协议。
2. 网卡驱动程序体系结构：
```txt

                            数据包发送                          数据包接收
网络协议接口层：           dev_queue_xmit()                     netif_rx()
------------------------------------------------------------------------------
                                \/                                 /\
网络设备接口层：                         结构体net_device
------------------------------------------------------------------------------
                                \/                                 /\
                           数据包发送                         中断处理(数据包接收)
设备驱动功能层：          hard_start_xmit() 
------------------------------------------------------------------------------
                                \/                                 /\
网络设备与媒介层                            网络物理设备媒介

```

3. 各个功能层说明
   1. 网络协议接口层：给上层系统以提供透明的数据包发送和接收接口（其实就是上面两函数）。接口函数传递的是结构体`struct sk_buff`，该结构体其实就是一个网络数据帧；
   2. 网络设备接口层：为千变万化的网络设备定义统一、抽象的数据结构`net_device`，该结构体主要内容是设备名称、物理信息（内存地址等）、设备操作函数等；
   3. 设备驱动功能层：其实就是`nei_device`的成员（属性、设备操作函数等），通过该层赋予具体的数值和函数，该设备驱动具有操作网络设备的功能；
   4. 网络设备与媒介层：具体的物理网卡、路由器等。

## 2. DM9000驱动程序编写流程
1. 内核自带的dm9000驱动程序，本质就是平台设备驱动的驱动端设备，驱动程序提供了对网卡的通用操作，而开发工作只需提供网卡设备的物理信息。
// TODO: 找出内核对设备操作的内容（主要是ioremap, 而后直接写入数据到对应地址中）
```txt
路径：linux-3.4.2\drivers\net\ethernet\davicom\dm9000.c
static struct platform_driver dm9000_driver;
    dm9000_probe
        ndev = alloc_etherdev(sizeof(struct board_info));       // sizeof(struct board_info)为私有空间大小
        ether_setup(ndev);                                      // 预置net_device的值
        ndev->netdev_ops	= &dm9000_netdev_ops;               // 操作函数集合
        ...;
        ret = register_netdev(ndev);                            // 注册设备端
```

1. dm9000的设备端信息，可以在arch/arm/mach-s3c24xx/mack-smdk2440.c中直接增加即可，在编译内核镜像时，会从该文件中获取通用的设备信息，从而可以成功与驱动端成功match。